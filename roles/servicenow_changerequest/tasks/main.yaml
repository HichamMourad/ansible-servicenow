---

- name: Create a change request
  snow_record:
    state: present
    table: change_request
    username: "{{ snow_credentials.username }}"
    password: "{{ snow_credentials.password }}"
    instance: "{{ snow_credentials.instance }}"
    data:
      severity: "{{ change_request.severity }}"
      priority: "{{ change_request.priority }}"
      short_description: "Planned Change: Application Deployment"
      implementation_plan: "Updated by Red Hat Advanced Cluster Management for Kubernetes"
      justification: "A new revision was available from the application channel in GitHub."
      description: "The following resources have been updated: [...]"
      risk_impact_analysis: "Changes are made automatically based on approved changes in GitHub."
      test_plan: "Run synthetic validation tests post-deployment."
      start_date: "{{ ansible_date_time.iso8601 }}"
  register: new_incident

- debug:
    var: new_incident.record